"use strict";!function(e){function t(){e(document).on("click",".search-form-ico-mobile",function(){e("#serch-form").addClass("full-width")}),e(document).on("click",".search-form-close",function(){e("#serch-form").removeClass("full-width")}),e(document).on("click",".mobi-par-cart__door-open",function(){var t=e(this).parents(".mobi-par-cart"),o=t.attr("data-blick");e(this).css("display","none"),t.find(".mobi-par-cart__door-close").css("display","inline-block"),t.find(".mobi-par-cart__info").slideDown(),BX.arh_obj_block_open[o]=!0}),e(document).on("click",".mobi-par-cart__door-close",function(){var t=e(this).parents(".mobi-par-cart"),o=t.attr("data-blick");e(this).css("display","none"),t.find(".mobi-par-cart__door-open").css("display","inline-block"),t.find(".mobi-par-cart__info").slideUp(),BX.arh_obj_block_open[o]=!1})}function o(){var t=e(".adress");0<t.length&&(e(document).on("click",".adress",function(){e(this).toggleClass("is-open"),e(".adress__list").slideToggle(300,"linear")}),t.hover(function(){},function(){e(this).removeClass("is-open"),e(".adress__list").slideUp(300,"linear")}))}function n(){var t=e(".sort-view__link");if(0<t.length){var o={0:"",1:"catalog-goriz",2:"catalog-tabl"},n="is-select",r=localStorage.getItem("vid_catalog_index");null!==r&&(e("body").addClass(o[r]),t.removeClass(n),e(t[r]).addClass(n)),e(document).on("click",".sort-view__link",function(){var r=e(this),i=r.index();t.removeClass(n),r.addClass(n),e.each(o,function(t,o){e("body").removeClass(o)}),e("body").addClass(o[i]),localStorage.setItem("vid_catalog_index",i)})}}function r(){0<e(".catalog-category").length&&e(document).on("click",".catalog-category__sub",function(){var t=e(this).parents(".catalog-category__item");t.toggleClass("is-open"),t.find(".deep-lev-1").slideToggle()}),e(document).on("click",".mobile-button",function(){e(this).parent(".catalog-category").toggleClass("opened")})}function i(){var t=e("#filter-form-catalog");if(0<t.length){var o=!0;e(document).on("change",".filter-block__checkbox-input",function(){var n=e(this).parents(".filter-block__container"),r=0,i=[];e.each(n.find(".filter-block__checkbox-input"),function(){e(this).prop("checked")&&r++}),e.each(t.find(".filter-block__checkbox-input"),function(){e(this).prop("checked")&&i.push(e(this).next(".filter-block__checkbox-fufel").find(".filter-block__checkbox-name").text())}),r=0<r?"("+r+")":"",n.find(".filter-block__count").text(r);var s=t.attr("action")+"?";s+=t.serialize()+"&set_filter=1",o&&e.get(s,function(t){var o=e(t);e(".js-load-prod").empty().append(o.find(".catalog-product__item")),e(".js-load-paging").empty().append(o.find(".js-load-paging .paging-block"));var n="<span class='fil-res'>Найдено ",r=1*o.find(".filter-block").attr("data-count");n+=r+" "+a(r,"товар","товара","товаров")+" по фильтрам:<span>",n+=" "+i.join(", "),n=0<i.length?n:"",e(".filter-itog__text").html(n)})}),e(document).on("click",".js-load-paging a",function(){var t=e(this).attr("href");return e.get(t,function(t){var o=e(t);e(".js-load-prod").empty().append(o.find(".catalog-product__item")),e(".js-load-paging").empty().append(o.find(".js-load-paging .paging-block"))}),!1}),e(document).on("click",".js-filter-res",function(){o=!1,e.each(t.find(".filter-block__checkbox-input"),function(){e(this).prop("checked")&&e(this).trigger("click")}),o=!0;var n=t.attr("action")+"?del_filter=1";e.get(n,function(t){var o=e(t);e(".js-load-prod").empty().append(o.find(".catalog-product__item")),e(".js-load-paging").empty().append(o.find(".js-load-paging .paging-block")),e(".filter-itog__text").empty()})})}}function a(e,t,o,n){var e=g(e)%100,r=e%10;return 10<e&&20>e?n:1<r&&5>r?o:1==r?t:n}function s(){e(document).on("input",".js-card-count",function(){var t=e(this),o=t.parents(".js-prod-item"),n=1*t.val();0>=n&&(n=1,t.val(n));var r=o.find(".js-add-basket").attr("data-link");r=e.parseJSON(r).price,r=parseFloat(r)*n,r=v(r,2,"."," ")+" Р",o.find(".js-cart-price").text(r)}),e(document).on("click",".js-sel-product",function(){var t=e(this),o=t.parents(".js-prod-item"),n=t.attr("data-big-data");o.find(".js-sel-product").removeClass("is-chek"),t.addClass("is-chek");var r=e.parseJSON(n).price;r=parseFloat(r)*(1*o.find(".js-card-count").val()),r=v(r,2,"."," ")+" Р",o.find(".js-cart-price").text(r),o.find(".js-add-basket").attr("data-link",n)}),e(document).on("click",".js-offers-toggle",function(){var t=e(this).parents(".js-prod-item");t.find(".js-offers-hid").slideToggle(),t.find(".js-variation").toggleClass("is-show")}),e(document).on("click",".js-add-basket",function(){var t=e(this).parents(".js-prod-item"),o=e(this).attr("data-link");o=e.parseJSON(o).basket_link,o+="&quantity="+t.find(".js-card-count").val(),window.location.href=o}),e(document).on("click",".js-card-plus, .js-card-minus",function(){var t=e(this).parents(".js-cart-counter"),o=t.find(".js-card-count").val();e(this).hasClass("js-card-plus")?o++:e(this).hasClass("js-card-minus")&&(o--,o=0>=o?1:o);var n=e.parseJSON(t.find(".js-add-basket").attr("data-link"));n=parseFloat(n.price)*o,n=v(n,2,"."," ")+" Р",t.find(".js-cart-price").text(n),t.find(".js-card-count").val(o)}),e(document).on("change",".js-card-count",function(){0>=e(this).val()&&e(this).val("1")})}function c(){e(document).on("click",".js-modal-coupon",function(){return e(".market-cart").addClass("coupon-show"),!1}),e(document).on("click",".coupon-modal__close",function(){e(".market-cart").removeClass("coupon-show")})}function l(){e(".arh-sel-city").selectPlug({class:"order-city-sel",changeSelect:{"#select-region-origin":{value:""},"#recent-delivery-value":{value:""},"#select-region-order":{value:""}}})}function d(){e(".product-slider").slick({slidesToShow:1,slidesToScroll:1,infinite:!0,arrows:!0,fade:!0,asNavFor:".product-slider-mini",prevArrow:'<button type="button" class="slick-prev"></button>',nextArrow:'<button type="button" class="slick-next"></button>'}),e(".product-slider-mini").slick({slidesToShow:4,slidesToScroll:1,infinite:!0,focusOnSelect:!0,asNavFor:".product-slider",dots:!1,arrows:!1})}function u(){e(".prod-light-box").fancybox()}function p(){e(document).on("click",".nav-burger",function(){e(this).toggleClass("open"),e(".header-mobile-menu").toggleClass("open")})}function f(){function t(t){var o=e("#order-country").val(),n=window.order_city[o],r="",i=0;1<t.length&&(r+='<div class="gorod-text__list">',e.each(n,function(e,o){var n=o.toLowerCase(),a=t.toLowerCase();-1<n.indexOf(a)&&(r+='<span class="gorod-text__item" data-code="'+e+'">'+o+"</span>",i++)}),r+="<div>"),e(".gorod-text__list").remove(),e("#select-region-origin, #recent-delivery-value").val(""),0<i&&e(".gorod-text").append(r)}e(document).on("input","#select-region-order",function(){e(this).removeClass("error"),t(e(this).val())}),e(document).on("click",".gorod-text__item",function(){e("#select-region-order").val(e(this).text()).removeClass("error"),e("#select-region-origin, #recent-delivery-value").val(e(this).attr("data-code")),e(".gorod-text__list").remove(),BX.Sale.OrderAjaxComponent.sendRequest()}),e(document).on("input","#select-region-order",function(){""==e(this).val()&&BX.Sale.OrderAjaxComponent.sendRequest()})}function h(){e(document).on("change",".order-row__payment-input",function(){e(".order-row__payment-desc").slideUp(),e(this).parents(".order-row__payment-row").find(".order-row__payment-desc").slideDown(),e(".order-row__payment-row").removeClass("error"),BX.Sale.OrderAjaxComponent.sendRequest()}),e(document).on("change",".order-row__delivery-input",function(){e(".order-row__delivery-desc").slideUp(),e(this).parents(".order-row__delivery-row").find(".order-row__delivery-desc").slideDown(),e(".order-row__delivery-row").removeClass("error"),BX.Sale.OrderAjaxComponent.sendRequest()}),e(document).on("change","#kolhoz-text-chek-input",function(){e(this).prop("checked")?(e(".order-buyer-gorod, .order-buyer-dom").removeAttr("style"),e("#select-region-origin, #select-region-order, #recent-delivery-value").val(""),e("#select-region-order").css({opacity:.3,"pointer-events":"none"}).removeClass("error"),e("#alt-local").val(1)):(e(".order-buyer-gorod, .order-buyer-dom").css("display","none"),e("#select-region-order").removeAttr("style"),e("#alt-local").val(0))}),e(document).on("click",".save-order-arh",function(){var t=!0,o=null,n="";return""!=e("#select-region-origin").val()||e("#kolhoz-text-chek-input").prop("checked")||(n="#select-region-order",o="#err-city",t=!1),t&&e.each(e(".order-row__delivery-input"),function(){return e(this).prop("checked")?(t=!0,!1):(n=".order-row__delivery-row",o="#err-del",void(t=!1))}),t&&e.each(e(".order-row__payment-input"),function(){return e(this).prop("checked")?(t=!0,!1):(n=".order-row__payment-row",o="#err-pay",void(t=!1))}),t&&(n=[],""==e(".order-buyer-name input").val()&&(n.push(".order-buyer-name .order-buyer__field"),t=!1),""==e(".order-buyer-famil input").val()&&(n.push(".order-buyer-famil .order-buyer__field"),t=!1),""==e(".order-buyer-phone input").val()&&(n.push(".order-buyer-phone .order-buyer__field"),t=!1),""==e(".order-buyer-index input").val()&&(n.push(".order-buyer-index .order-buyer__field"),t=!1),(""==e(".order-buyer-email input").val()||-1==e(".order-buyer-email input").val().indexOf("@"))&&(n.push(".order-buyer-email .order-buyer__field"),t=!1),e("#kolhoz-text-chek-input").prop("checked")&&(""==e(".order-buyer-gorod input").val()&&(n.push(".order-buyer-gorod .order-buyer__field"),t=!1),""==e(".order-buyer-dom input").val()&&(n.push(".order-buyer-dom .order-buyer__field"),t=!1)),o="#err-buyer",n=n.join(", ")),t&&(n=[],!e("#valid-one").prop("checked")&&(n.push(".valid-order:first-child"),t=!1),!e("#valid-two").prop("checked")&&(n.push(".valid-order:last-child"),t=!1),o="#err-side",n=n.join(", ")),t?void BX.Sale.OrderAjaxComponent.sendRequest("saveOrderAjax"):(e(n).addClass("error"),e("html, body").animate({scrollTop:e(o).offset().top-180+"px"},{duration:1e3,easing:"swing"}),!1)})}function v(e,t,o,n){var r=Math.round;e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+e)?+e:0,a=isFinite(+t)?g(t):0,s=void 0===n?",":n,c=void 0===o?".":o,l="";return l=(a?function(e,t){var o=Math.pow(10,t);return""+(r(e*o)/o).toFixed(t)}(i,a):""+r(i)).split("."),3<l[0].length&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),(l[1]||"").length<a&&(l[1]=l[1]||"",l[1]+=Array(a-l[1].length+1).join("0")),l.join(c)}var g=Math.abs;window.order_step={city:!1,deliver:!1,payment:!1},e(function(){t(),o(),n(),r(),i(),s(),c(),l(),d(),u(),p(),f(),h()})}(jQuery);